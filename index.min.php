<?php
    error_reporting(E_ALL);
    header("Expires: on, 01 Jan 1970 00:00:00 GMT");
    header("Last-Modified: " . gmdate("D, d M Y H:i:s") . " GMT");
    header("Cache-Control: no-store, no-cache, must-revalidate");
    header("Cache-Control: post-check=0, pre-check=0", false);
    header("Pragma: no-cache");
    require "thumbs.php";
    ?><!DOCTYPE html><html><head><title>Imagr</title><meta name="viewport" content="width=device-width" /><script>function json_decode(str_json){var json=this.window.JSON;if(typeof json==="object"&&typeof json.parse==="function"){try{return json.parse(str_json)}catch(err){if(!(err instanceof SyntaxError)){throw new Error("Unexpected error type in json_decode()")}this.php_js=this.php_js||{};this.php_js.last_error_json=4;return null}}var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;var j;var text=str_json;cx.lastIndex=0;if(cx.test(text)){text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})}if((/^[\],:{}\s]*$/).test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){j=eval("("+text+")");return j}this.php_js=this.php_js||{};this.php_js.last_error_json=4;return null}function file_get_contents(l,s,f,p,j){var J,c=[],z=[],A=0,B=0,C="",q=-1,d=0,y=null,F=false;var o=function(e){return e.substring(1)!==""};this.php_js=this.php_js||{};this.php_js.ini=this.php_js.ini||{};var r=this.php_js.ini;f=f||this.php_js.default_streams_context||null;if(!s){s=0}var I={FILE_USE_INCLUDE_PATH:1,FILE_TEXT:32,FILE_BINARY:64};if(typeof s==="number"){d=s}else{s=[].concat(s);for(B=0;B<s.length;B++){if(I[s[B]]){d=d|I[s[B]]}}}if(d&I.FILE_BINARY&&(d&I.FILE_TEXT)){throw"You cannot pass both FILE_BINARY and FILE_TEXT to file_get_contents()"}if((d&I.FILE_USE_INCLUDE_PATH)&&r.include_path&&r.include_path.local_value){var x=r.include_path.local_value.indexOf("/")!==-1?"/":"\\";l=r.include_path.local_value+x+l}else{if(!/^(https?|file):/.test(l)){C=this.window.location.href;q=l.indexOf("/")===0?C.indexOf("/",8)-1:C.lastIndexOf("/");l=C.slice(0,q+1)+l}}var w;if(f){w=f.stream_options&&f.stream_options.http;F=!!w}if(!f||!f.stream_options||F){var b=this.window.ActiveXObject?new ActiveXObject("Microsoft.XMLHTTP"):new XMLHttpRequest();if(!b){throw new Error("XMLHttpRequest not supported")}var g=F?w.method:"GET";var n=!!(f&&f.stream_params&&f.stream_params["phpjs.async"]);if(r["phpjs.ajaxBypassCache"]&&r["phpjs.ajaxBypassCache"].local_value){l+=(l.match(/\?/)==null?"?":"&")+(new Date()).getTime()}b.open(g,l,n);if(n){var a=f.stream_params.notification;if(typeof a==="function"){if(0&&b.addEventListener){}else{b.onreadystatechange=function(e){var i={responseText:b.responseText,responseXML:b.responseXML,status:b.status,statusText:b.statusText,readyState:b.readyState,evt:e};var k;switch(b.readyState){case 0:a.call(i,0,0,"",0,0,0);break;case 1:a.call(i,0,0,"",0,0,0);break;case 2:a.call(i,0,0,"",0,0,0);break;case 3:k=b.responseText.length*2;a.call(i,7,0,"",0,k,0);break;case 4:if(b.status>=200&&b.status<400){k=b.responseText.length*2;a.call(i,8,0,"",b.status,k,0)}else{if(b.status===403){a.call(i,10,2,"",b.status,0,0)}else{a.call(i,9,2,"",b.status,0,0)}}break;default:throw"Unrecognized ready state for file_get_contents()"}}}}}if(F){var H=(w.header&&w.header.split(/\r?\n/))||[];var v=false;for(B=0;B<H.length;B++){var E=H[B];var D=E.search(/:\s*/);var m=E.substring(0,D);b.setRequestHeader(m,E.substring(D+1));if(m==="User-Agent"){v=true}}if(!v){var t=w.user_agent||(r.user_agent&&r.user_agent.local_value);if(t){b.setRequestHeader("User-Agent",t)}}y=w.content||null}if(d&I.FILE_TEXT){var u="text/html";if(w&&w["phpjs.override"]){u=w["phpjs.override"]}else{var h=(r["unicode.stream_encoding"]&&r["unicode.stream_encoding"].local_value)||"UTF-8";if(w&&w.header&&(/^content-type:/im).test(w.header)){u=w.header.match(/^content-type:\s*(.*)$/im)[1]}if(!(/;\s*charset=/).test(u)){u+="; charset="+h}}b.overrideMimeType(u)}else{if(d&I.FILE_BINARY){b.overrideMimeType("text/plain; charset=x-user-defined")}}try{if(w&&w["phpjs.sendAsBinary"]){b.sendAsBinary(y)}else{b.send(y)}}catch(G){return false}J=b.getAllResponseHeaders();if(J){J=J.split("\n");for(A=0;A<J.length;A++){if(o(J[A])){z.push(J[A])}}J=z;for(B=0;B<J.length;B++){c[B]=J[B]}this.$http_response_header=c}if(p||j){if(j){return b.responseText.substr(p||0,j)}return b.responseText.substr(p)}return b.responseText}return false}function in_array(e,d,c){var b="",a=!!c;if(a){for(b in d){if(d[b]===e){return true}}}else{for(b in d){if(d[b]==e){return true}}}return false}function isset(){var c=arguments,b=c.length,d=0,e;if(b===0){throw new Error("Empty isset")}while(d!==b){if(c[d]===e||c[d]===null){return false}d++}return true}function rand(b,a){var c=arguments.length;if(c===0){b=0;a=2147483647}else{if(c===1){throw new Error("Warning: rand() expects exactly 2 parameters, 1 given")}}return Math.floor(Math.random()*(a-b+1))+b}function basename(e,d){var a=e;var c=a.charAt(a.length-1);if(c==="/"||c==="\\"){a=a.slice(0,-1)}a=a.replace(/^.*[\/\\]/g,"");if(typeof d==="string"&&a.substr(a.length-d.length)==d){a=a.substr(0,a.length-d.length)}return a}function substr(k,a,g){var f=0,c=true,m=0,b=0,j=0,h="";k+="";var e=k.length;this.php_js=this.php_js||{};this.php_js.ini=this.php_js.ini||{};switch((this.php_js.ini["unicode.semantics"]&&this.php_js.ini["unicode.semantics"].local_value.toLowerCase())){case"on":for(f=0;f<k.length;f++){if(/[\uD800-\uDBFF]/.test(k.charAt(f))&&/[\uDC00-\uDFFF]/.test(k.charAt(f+1))){c=false;break}}if(!c){if(a<0){for(f=e-1,m=(a+=e);f>=m;f--){if(/[\uDC00-\uDFFF]/.test(k.charAt(f))&&/[\uD800-\uDBFF]/.test(k.charAt(f-1))){a--;m--}}}else{var d=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g;while((d.exec(k))!=null){var l=d.lastIndex;if(l-2<a){a++}else{break}}}if(a>=e||a<0){return false}if(g<0){for(f=e-1,b=(e+=g);f>=b;f--){if(/[\uDC00-\uDFFF]/.test(k.charAt(f))&&/[\uD800-\uDBFF]/.test(k.charAt(f-1))){e--;b--}}if(a>e){return false}return k.slice(a,e)}else{j=a+g;for(f=a;f<j;f++){h+=k.charAt(f);if(/[\uD800-\uDBFF]/.test(k.charAt(f))&&/[\uDC00-\uDFFF]/.test(k.charAt(f+1))){j++}}return h}break}case"off":default:if(a<0){a+=e}e=typeof g==="undefined"?e:(g<0?g+e:g+a);return a>=k.length||a<0||a>e?!1:k.slice(a,e)}return undefined}function explode(b,c,a){if(arguments.length<2||typeof b==="undefined"||typeof c==="undefined"){return null}if(b===""||b===false||b===null){return false}if(typeof b==="function"||typeof b==="object"||typeof c==="function"||typeof c==="object"){return{0:""}}if(b===true){b="1"}b+="";c+="";var d=c.split(b);if(typeof a==="undefined"){return d}if(a===0){a=1}if(a>0){if(a>=d.length){return d}return d.slice(0,a-1).concat([d.slice(a-1).join(b)])}if(-a>=d.length){return[]}d.splice(d.length+a);return d}function urldecode(a){return decodeURIComponent((a+"").replace(/%(?![\da-f]{2})/gi,function(){return"%25"}).replace(/\+/g,"%20"))}(function(){if(!Event.prototype.preventDefault){Event.prototype.preventDefault=function(){this.returnValue=false}}if(!Event.prototype.stopPropagation){Event.prototype.stopPropagation=function(){this.cancelBubble=true}}if(!Element.prototype.addEventListener){var c=[];var b=function(f,h){var d=this;var j=function(k){k.target=k.srcElement;k.currentTarget=d;if(h.handleEvent){h.handleEvent(k)}else{h.call(d,k)}};if(f=="DOMContentLoaded"){var g=function(k){if(document.readyState=="complete"){j(k)}};document.attachEvent("onreadystatechange",g);c.push({object:this,type:f,listener:h,wrapper:g});if(document.readyState=="complete"){var i=new Event();i.srcElement=window;g(i)}}else{this.attachEvent("on"+f,j);c.push({object:this,type:f,listener:h,wrapper:j})}};var a=function(f,g){var d=0;while(d<c.length){var e=c[d];if(e.object==this&&e.type==f&&e.listener==g){if(f=="DOMContentLoaded"){this.detachEvent("onreadystatechange",e.wrapper)}else{this.detachEvent("on"+f,e.wrapper)}break}++d}};Element.prototype.addEventListener=b;Element.prototype.removeEventListener=a;if(HTMLDocument){HTMLDocument.prototype.addEventListener=b;HTMLDocument.prototype.removeEventListener=a}if(Window){Window.prototype.addEventListener=b;Window.prototype.removeEventListener=a}}})();/*! @source http://purl.eligrey.com/github/classList.js/blob/master/classList.js*/;if("document" in self&&!("classList" in document.createElement("_"))){(function(j){if(!("Element" in j)){return}var a="classList",f="prototype",m=j.Element[f],b=Object,k=String[f].trim||function(){return this.replace(/^\s+|\s+$/g,"")},c=Array[f].indexOf||function(q){var p=0,o=this.length;for(;p<o;p++){if(p in this&&this[p]===q){return p}}return -1},n=function(o,p){this.name=o;this.code=DOMException[o];this.message=p},g=function(p,o){if(o===""){throw new n("SYNTAX_ERR","An invalid or illegal string was specified")}if(/\s/.test(o)){throw new n("INVALID_CHARACTER_ERR","String contains an invalid character")}return c.call(p,o)},d=function(s){var r=k.call(s.getAttribute("class")||""),q=r?r.split(/\s+/):[],p=0,o=q.length;for(;p<o;p++){this.push(q[p])}this._updateClassName=function(){s.setAttribute("class",this.toString())}},e=d[f]=[],i=function(){return new d(this)};n[f]=Error[f];e.item=function(o){return this[o]||null};e.contains=function(o){o+="";return g(this,o)!==-1};e.add=function(){var s=arguments,r=0,p=s.length,q,o=false;do{q=s[r]+"";if(g(this,q)===-1){this.push(q);o=true}}while(++r<p);if(o){this._updateClassName()}};e.remove=function(){var t=arguments,s=0,p=t.length,r,o=false;do{r=t[s]+"";var q=g(this,r);if(q!==-1){this.splice(q,1);o=true}}while(++s<p);if(o){this._updateClassName()}};e.toggle=function(p,q){p+="";var o=this.contains(p),r=o?q!==true&&"remove":q!==false&&"add";if(r){this[r](p)}return !o};e.toString=function(){return this.join(" ")};if(b.defineProperty){var l={get:i,enumerable:true,configurable:true};try{b.defineProperty(m,a,l)}catch(h){if(h.number===-2146823252){l.enumerable=false;b.defineProperty(m,a,l)}}}else{if(b[f].__defineGetter__){m.__defineGetter__(a,i)}}}(self))}if(!Array.prototype.forEach){Array.prototype.forEach=function(d,c){for(var b=0,a=this.length;b<a;++b){d.call(c,this[b],b,this)}}}Element.prototype.setDataAttribute=function(a,b){if(b!==undefined){return this.setAttribute("data-"+a,b)}else{return this.removeDataAttribute(a)}};Element.prototype.removeDataAttribute=function(a){return this.removeAttribute("data-"+a)};Element.prototype.setDataAttributes=function(a){if(a instanceof Object){for(attr in a){if(a.hasOwnProperty(attr)){this.setDataAttribute(attr,a[attr])}}}};if(!Element.prototype.__lookupGetter__("dataset")){Element.prototype.__defineGetter__("dataset",function(){try{var a={};a.__defineGetter__("test",function(){});delete a;var f={}}catch(g){var f=document.createElement("div")}function c(e){return function(){return e}}function h(e,i){return function(j){return e.setDataAttribute(i,j)}}for(attr in this.attributes){if(this.attributes.hasOwnProperty(attr)&&this.attributes[attr].name&&/^data-[a-z_\-\d]*$/i.test(this.attributes[attr].name)){var d=this.attributes[attr].name.substr(5),b=this.attributes[attr].value;try{f.__defineGetter__(d,c(b||""));f.__defineSetter__(d,h(this,d))}catch(g){f[d]=b}}}return f})};</script><body><div id="grid"></div><div id="bigpic" style="cursor:pointer;display:none"></div><script>var thumbsize=0,realsize,hash=location.hash,argr,args,mobile=false;if(/Android|webOS|iPhone|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)){mobile=true}if(mobile){realsize=screen.width*2}else{realsize=screen.width+(screen.width/10)}if(hash[1]=="!"){console.info("Parsing URL paramenters...");if(hash.length<=2){console.warn("No arguments provided but #!. Stopping.")}else{argr=substr(hash,2);args=explode("|",argr);for(var i=0;i<args.length;i++){var arg=explode("=",args[i]),key=arg[0],value=arg[1];if(value==undefined){console.warn("No value given")}if(arg.length>2){console.warn("Multiple values specified, using first one")}console.log("Key: "+key+" value: "+value);if(key=="ts"){if(value!=""){thumbsize=value}}if(key=="rs"){if(value!=""){realsize=value}}}}}var imgs=Array(<?php
        $imgs = glob("*");
        $imglen = sizeof($imgs)-1;
        $invalid_files_length = 0;
        $rkey = 0;
        $invalid_extensions=Array("php","zip","html","html~","php~","json","json~","log","svg","mov","svg~","license","dir","zip","meta","js","md");
        foreach($imgs as $key => $img)
        {
          $extension = getextension($img);
      if(in_array($extension,$invalid_extensions))
        {
            $invalid_files_length++;
          }
        }
    //    echo "/*imglength = {$imglen}, invalid_files_length = {$invalid_files_length}*/\n";
        foreach($imgs as $key => $img)
        {
          $extension = getextension($img);
          if(!in_array($extension,$invalid_extensions))
          {
            echo "\"" . thumb($img) . "\"";
            if($rkey != $imglen-$invalid_files_length)
            {
              echo ",";
            }
            $rkey++;
          }
      //    echo " /* file = {$img}, extension = {$extension}, key = {$key}, rkey = {$rkey}*/\n";
        }
      ?>),grid=document.getElementById("grid"),meta=json_decode(file_get_contents("meta?"+rand(1,200))),container=document.getElementById("bigpic"),isMobile=false,desc=document.createElement("span"),prevb=document.createElement("img"),nextb=document.createElement("img"),img=document.createElement("img");bigpic.onclick=function(a){if(a.target.id==this.id){this.style.display="none"}};prevb.src="prev.svg";prevb.classList.add("prev");prevb.classList.add("symbol");prevb.classList.add("vertcent");prevb.style.width="10%";prevb.addEventListener("click",prev);container.appendChild(prevb);nextb.src="next.svg";nextb.classList.add("next");nextb.classList.add("symbol");nextb.classList.add("vertcent");nextb.style.width="10%";nextb.addEventListener("click",next);container.appendChild(nextb);img.classList.add("largepic");img.classList.add("cent");container.appendChild(img);var infobut=document.createElement("img");infobut.src="info.svg";infobut.classList.add("symbol");infobut.style.width="7%";infobut.style.bottom="2%";infobut.addEventListener("click",infooverlay);infobut.classList.add("horcent");container.appendChild(infobut);var infolay=document.createElement("div");infolay.classList.add("infolay");infolay.classList.add("horcent");infolay.classList.add("closed");container.appendChild(infolay);imgs.forEach(function(a){var b=document.createElement("img");if(thumbsize!=0){b.src="download.php/resize/"+(parseInt(thumbsize)+(parseInt(thumbsize)/10))+"/"+a;b.style.width=thumbsize+"px"}else{b.src="thumbs.dir/"+a+".jpg";b.style.width="19%";if(mobile){b.style.width="92%"}b.style.minWidth="200px"}b.setDataAttribute("original",a);b.classList.add("image");if(meta[a]!=undefined){b.setDataAttribute("by",meta[a].by);b.setDataAttribute("description",meta[a].description)}b.addEventListener("click",openpic);grid.appendChild(b)});function openpic(c){if(this.tagName=="IMG"){c=this}if(realsize==0){img.src=c.dataset.original}else{img.src="download.php/resize/"+realsize+"/"+c.dataset.original}container.style.display="";if(c.dataset.by!=undefined){infobut.style.display="";var b=json_decode(file_get_contents("download.php/exif/"+basename(img.src))),a=c.dataset.description+", hochgeladen von "+c.dataset.by;if(c.dataset.description=="undefined"){var a="Hochgeladen von "+c.dataset.by}if(b!=false){if(b.Make!=undefined){if(b.Make==b.Model){var d=b.Model}else{var d=b.Make+" "+b.Model}infolay.innerHTML=a+",<br />fotografiert am "+b.DateTime+", mit einer "+d+", Aufl&ouml;sung: "+b.ExifImageWidth+"x"+b.ExifImageLength}else{infolay.innerHTML=a+", fotografiert am "+b.DateTime}}else{infolay.innerHTML=a}infolay.innerHTML+='<br /><a style="color:white;" href="download.php/'+basename(img.src)+'">Download</a>'}else{infobut.style.display="none";infolay.classList.add("closed")}}function infooverlay(a){infolay.classList.toggle("closed")}function findthumb(b){var a=document.getElementsByClassName("image");for(i=0;i<a.length;i++){if(a[i].dataset.original==b){return a[i]}}}function next(b){var a=(findimg(basename(img.src))+1);if(a==imgs.length){a=0}openpic(findthumb(imgs[a]))}function prev(a){var b=findimg(basename(img.src))-1;if(b<0){b=(imgs.length-1)}openpic(findthumb(imgs[b]))}function findimg(a){for(i=0;i<=imgs.length;i++){if(imgs[i]==urldecode(a)){return i}}}document.onkeyup=function(b){var a=b.keyCode||b.which;if(a==39){next()}if(a==37){prev()}};</script><style>.image{margin:20px;box-shadow:5px 5px 5px grey;border:5px solid white;transition-duration:.5s;transition-property:all;-webkit-transition-duration:.5s;-webkit-transition-property:all}.image:hover{border:5px solid red;cursor:pointer;border-radius:5%}body{background:black}#bigpic{left:0;top:0;position:fixed;bottom:0;right:0;z-index:2;background:rgba(200,200,200,0.6)}.largepic{max-width:90%;box-shadow:10px 10px 20px;max-height:90%;left:50%;top:50%;z-index:3;cursor:default;position:absolute}.prev{left:2%}.symbol{background:rgba(0,0,0,0.5);border-radius:50%;position:absolute;z-index:5}.vertcent{top:50%;transform:translateY(-50%);-webkit-transform:translateY(-50%)}.horcent{left:50%;transform:translateX(-50%);-webkit-transform:translateX(-50%)}.cent{transform:translateX(-50%) translateY(-50%);-webkit-transform:translateX(-50%) translateY(-50%)}.next{right:2%}.infolay{background:none repeat scroll 0 0 rgba(0,0,0,0.5);color:#fff;cursor:default;font-family:helvetica;min-height:5%;overflow:auto;padding:10px;position:fixed;text-align:center;top:3%;transition-duration:3s;transition-property:all;width:90%;z-index:5}.closed{opacity:0;width:0;height:0}</style></body></html>
