function CE(a){return document.createElement(a)}HTMLElement.prototype.appendChilds=function(){var e=arguments,d=0;for(;d<e.length;d++){var f=e[d];if(typeof f=="object"){this.appendChild(e[d])}}};function fqueue(c){c.preventDefault();var b=c.target.files!=undefined?c.target.files:c.dataTransfer.files,a=0;for(;a<b.length;a++){var d=b[a];if(d.type.match(/image.*/)){if(typeof empty!="undefined"&&empty!=undefined){empty.style.display="none"}read(d)}else{alert("File: "+d.name+" is not an image")}}}function force_fs(){var a=document.documentElement;if(a.requestFullscreen){a.requestFullscreen()}else{if(a.mozRequestFullScreen){a.mozRequestFullScreen()}else{if(a.webkitRequestFullscreen){a.webkitRequestFullscreen()}else{if(a.msRequestFullscreen){a.msRequestFullscreen()}}}}}function fs(){if((document.fullscreenEnabled==false)||(document.mozFullScreen==false)||(document.webkitIsFullScreen==false)){var a=document.documentElement;if(a.requestFullscreen){a.requestFullscreen()}else{if(a.mozRequestFullScreen){a.mozRequestFullScreen()}else{if(a.webkitRequestFullscreen){a.webkitRequestFullscreen()}else{if(a.msRequestFullscreen){a.msRequestFullscreen()}}}}}else{if(document.exitFullscreen){document.exitFullscreen()}else{if(document.mozCancelFullScreen){document.mozCancelFullScreen()}else{if(document.webkitExitFullscreen){document.webkitExitFullscreen()}}}}}function read(b){while(upname==null||upname.length<2){upname=prompt("Please enter your name","")}var a=new FileReader();a.addEventListener("load",function(c){upload(c.target.result,b.name,b.lastModified)});a.readAsDataURL(b)}function do_upload(a){var b=new xhr();b.addEventListener("readystatechange",function(){if(this.readyState==4&&this.status==200){uploads.active--;uploads.queued--;var c=JSON.parse(this.responseText);if(c.success){a.success=true;a.binary="";a.container.remove();imgs.push(c.file);addimg(c.file);mdata[c.file]=c.exif;console.log(c.orig_file+" was successfully uploaded")}else{a.success=false;alert("There was an error while uploading: "+c.error+", file: "+c.file)}}});b.upload.addEventListener("progress",function(d){if(d.lengthComputable){var c=d.loaded/d.total;a.label.innerHTML=round(c*100,0)+"%";a.uploaded=c}else{console.warn("Unable to compute progress information since the total size is unknown")}});b.addEventListener("abort",function(){uploads.queued--;a.success=false;a.container.remove();console.log("an error occurred with upload id #"+a.id)});b.addEventListener("timeout",b.abort);b.addEventListener("error",b.abort);b.open("POST","upload.php?name="+a.fname+"&date="+a.date+"&by="+upname,true);b.send(a.image.src);a.uploading=true;uploads.active++}function loop(){sidebar.style.display=uploads.queued!=0?"":"none";var e=Object.keys(uploads),g=0,d=e.length,c=0;for(;g<d;g++){var b=e[g];if(b!="active"&&b!="queued"){var q=uploads[b];if(q.uploaded!=1){percentage=q.uploaded;c+=percentage}if(!q.uploading&&uploads.active<1){do_upload(q)}}}c/=uploads.queued;c*=100;var a=uploads.queued==0?"0%":c+"%";if(prog.style.width!=a){prog.style.width=a}var m=time()-lastmove;if(m>3){if(!chidden){hidectl()}}else{if(chidden){showctl()}}var f=location.hash;if(f[1]=="!"){if(f.length<=2){console.warn("No arguments provided but #!. Stopping.")}else{argr=f.substr(2);args=argr.split(",");for(var g=0;g<args.length;g++){var p=args[g].split("="),n=p[0],j=p[1];if(j==undefined){j=true}if(p.length>2){console.warn("Multiple values specified, using first one")}if(n=="ts"){if(j!=""){thumbsize=j}}if(n=="rs"){if(j!=""){realsize=j}}if(n=="image"){if(j!=""&&j!=undefined){var h=(container.style.display=="none");if(h||img.dataset.original!=j){var o=findthumb(j);if(o!=undefined&&(img.dataset.original!=o.dataset.original||h)){openpic(o)}}}}if(n=="info"){if(j=="true"&&!info){infolay.classList.remove("closed");info=true}else{if(j=="false"&&info){infolay.classList.add("closed");info=false}}}if(n=="overview"){if(j=="true"||j==true){if(container.style.display!="none"){container.click()}}}if(n=="smalldev"){j=="true"||j==true?smalldev=true:false}}}}requestAnimationFrame(loop)}function upload(){var g=arguments[0],f=arguments[1],b=arguments[2],c=new Image(),e=uniqid(),d=CE("div"),a=CE("span");c.src=g;c.addEventListener("load",function(){uploads[e]={image:c,fname:f,date:b,uploaded:0,uploading:false,id:e,label:a,container:d};uploads.queued++});d.classList.add("upfile");c.classList.add("upthumb");a.classList.add("uptext");a.classList.add("fade");c.classList.add("fade");a.appendChild(document.createTextNode("Waiting..."));d.appendChilds(c,a);sidebar.appendChild(d)}function update(){var b=new xhr(),a=url;b.open("GET","download.php/rename/"+a+"/"+this.id+"/"+this.textContent,true);b.addEventListener("readystatechange",function(){if(this.readyState==4&&this.status==200){var c=JSON.parse(this.responseText);if(!c.success){alert("Something went wrong while renaming")}mdata[a]=c.exif}});b.send()}function winwidth(){var b=window,h=document,f=h.documentElement,c=h.getElementsByTagName("body")[0],a=b.innerWidth||f.clientWidth||c.clientWidth;return a}function kinput(f){var c=f.target,d=c.contentEditable,a=c.tagName,b=f.keyCode||f.which;if(!d||a!="SPAN"){if(b==105){infooverlay()}if(b==102){fs()}if(b==27){f.preventDefault();container.click()}if(b==39||b==110){next()}if(b==37||b==112){prev()}if(b==8||b==46){f.preventDefault();del()}}else{lastmove=time()}if(d&&a=="SPAN"){if(b==13){f.preventDefault();c.blur()}}}function addimg(a){var b=CE("img");b.classList.add("loadingbg");if(thumbsize!=0){b.src="download.php/resize/"+(parseInt(thumbsize)+(parseInt(thumbsize)/10))+"/"+a;b.style.width=thumbsize+"px"}else{b.src=smalldev?"download.php/resize/110/"+a:"thumbs.dir/"+a+".jpg";b.style.maxWidth="10%"}b.dataset.original=a;b.classList.add("image");b.addEventListener("click",openpic);grid.appendChild(b)}function openpic(h){ib=0;if(this.tagName=="IMG"){h=this}if(h==undefined){console.warn("srcthumb is undefined");return}url=h.dataset.original;var a=false,z=imgs[url];if(z!=undefined&&z.substr(0,4)=="blob"){console.info("Reading image "+url+" from "+z);img.src=z;a=true}else{if(realsize==0){img.src=url}else{if(realsize=="dyn"){img.src="download.php/resize/"+(smalldev?winwidth()*4:(winwidth()/100)*95)+"/"+url}else{img.src="download.php/resize/"+realsize+"/"+url}}}img.dataset.original=url;location.hash="#!image="+basename(url)+(info?",info=true":"");container.style.display="";grid.style.webkitFilter=grid.style.filter="blur(9px)";while(infolay.firstChild){infolay.removeChild(infolay.firstChild)}var D=mdata[url]!=undefined?mdata[url]:JSON.parse(file_get_contents("download.php/exif/"+url)),g="";var v=D.meta,j="";if(v==false){v={}}if("title" in v&&v.title!=""){j+=v.title}else{j+="Unbenannt"}var e=CE("span");e.appendChild(document.createTextNode(j));if(features.renaming){e.contentEditable=true}e.id="title";e.addEventListener("blur",update);var r=CE("span");r.id="upby";r.appendChild(document.createTextNode("upby" in v&&v.upby!=""?v.upby:"Unbekannt"));if(features.renaming){r.contentEditable=true}r.addEventListener("blur",update);var q=CE("span"),b="description" in v&&v.description!=""?v.description:"Unbeschrieben";q.id="description";q.addEventListener("blur",update);q.appendChild(document.createTextNode(b));if(features.renaming){q.contentEditable=true}infolay.appendChilds(e,document.createTextNode(" von "),r,document.createTextNode(": "),q);if(D!=false&&D!=null){var u=D.width,n=D.height,c=D.make,d=D.model,s=isNaN(parseInt(D.GPS))?false:D.GPS,B=D.date,A=D.ISO,k=D.aperture,C=D.exposure,f=D.filesize,p=D.flash,o=D.software;if(B!=false){g+=", fotografiert am "+B}if(B!=false&&c!=false&&d!=false){var x=c+" "+d;if(c==d){x=d}if(d.indexOf(c)!=-1){x=d}g+=", mit einer / einem "+x}else{if(c!=false&&d!=false){var x=c+" "+d;if(c==d){x=d}if(d.indexOf(c)!=-1){x=d}g+=", fotografiert mit einer / einem "+x}}if(A!=false){g+=", ISO: "+A}if(k!=false){g+=", Blende: "+k}if(C!=false){g+=", Belichtungszeit: "+C}if(p!=false){g+=", Blitz aktiviert"}if(f!=false){g+=", Dateigröße: "+f}if(u!=false&&n!=false){g+=", Abmessungen: "+u+"x"+n}if(o!=false&&o!=null){g+=", software: "+o}infolay.appendChild(document.createTextNode(g+" "));var w=CE("a");w.download=url;w.href=a?z:"download.php/"+basename(url);w.appendChild(document.createTextNode("In Originalgröße downloaden"));infolay.appendChild(w);if(s!=false){var y=CE("a");y.target="_blank";y.href="//maps.apple.com/?q="+urlencode(s);y.appendChild(document.createTextNode("Ort in Karten öffnen"));infolay.appendChild(y)}if(features.deleting){infolay.appendChild(document.createTextNode("    "));var l=CE("button");l.addEventListener("click",del);l.classList.add("delbut");l.appendChild(document.createTextNode("Löschen"));infolay.appendChild(l)}}}function infooverlay(){infolay.classList.toggle("closed");info=infolay.classList.contains("closed")?false:true;if(container.style.display!="none"){location.hash="#!image="+url+(info?",info=true":"")}}function findthumb(a){return acs("image",function(b,c){var d=b.dataset.original;if(d==c){return b}},a)}function del(){var a=img.dataset.original,b=JSON.parse(file_get_contents("download.php/delete/"+a));if(b.success){next();findthumb(a).remove();imgs.splice(findimg(a),1);ety(true)}else{alert("Ein fehler ist beim löschen aufgetreten.")}}function next(c){var b=(findimg(img.dataset.original==undefined?basename(img.src):img.dataset.original)+1);if(b==imgs.length){b=0}var a=findthumb(imgs[b]);if(!badbrowser){img.style.width=img.width+"px";img.style.height=img.height+"px";img.src=a.src}openpic(a)}function rstx(){if(ib&1){this.style.width="";this.style.height=""}ib++}function moov(){lastmove=time()}function hidectl(){chidden=true;infobut.classList.add("hidden");prevb.classList.add("hidden");nextb.classList.add("hidden");if(!smalldev){img.classList.add("pmode");container.style.background="rgba(0,0,0,0.9)"}}function showctl(){chidden=false;infobut.classList.remove("hidden");prevb.classList.remove("hidden");nextb.classList.remove("hidden");if(!smalldev){container.style.background="";img.classList.remove("pmode")}}function prev(b){var c=findimg(img.dataset.original==undefined?basename(img.src):img.dataset.original)-1;if(c<0){c=(imgs.length-1)}var a=findthumb(imgs[c]);if(!badbrowser){img.style.width=img.width+"px";img.style.height=img.height+"px";img.src=a.src}openpic(a)}function findimg(a){for(i=0;i<=imgs.length;i++){if(imgs[i]==urldecode(a)){return i}}}function ety(){if(!imgs.length){empty=CE("div"),h1=CE("h1"),h2=CE("h2");h1.appendChild(document.createTextNode("Noch nichts da..."));h2.appendChild(document.createTextNode("Ziehe fotos auf diese Seite um sie hochzuladen"));empty.id="empty";empty.classList.add("cent");empty.appendChild(h1);empty.appendChild(h2);document.body.appendChild(empty);if(arguments[0]){container.click()}}}function iclick(a){if(a.target.id==this.id){this.style.display="none";grid.style.webkitFilter=grid.style.filter="";location.hash="#!overview"}}if(typeof HTMLElement.prototype.remove!="function"){HTMLElement.prototype.remove=function(){this.parentElement.removeChild(this)}}function mimg(b){var c=b.target,a=(ix||0)+b.dx;ix=a;a-=iwi/2;c.style.webkitTransform=c.style.transform="translate("+a+"px, -50%)"}function smimg(a){var b=a.target;iwi=b.clientWidth;b.classList.remove("fade");b.classList.remove("cent")}function emimg(b){var c=b.target;c.classList.add("cent");ix=0;c.setAttribute("style","");c.classList.add("fade");var a=b.clientX;if(a<(winwidth()/100)*10){prev()}if(a>(winwidth()/100)*90){next()}}function acs(f,e){var a=document.getElementsByClassName(f),d=0,c=0,b;for(;d<a.length;d++){if(arguments[2]!=undefined&&arguments[2].length>1){b=e(a[d],arguments[2]);if(!c){c=b}}else{e(a[d])}}return c}function hidestatus(){acs("uptext",function(a){a.style.opacity=0});acs("upfile",function(a){a.style.margin=0})}function showstatus(){acs("uptext",function(a){a.style.opacity=1});acs("upfile",function(a){a.style.margin="0.5%"})}function init(){window.thumbsize=0;window.svg=typeof SVGRect!="undefined"&&window.navigator.userAgent.indexOf("Windows")<0?true:false;window.realsize="dyn";window.argr="";window.args=[];window.info=false;window.smalldev=window.innerWidth<768;window.preload=false;window.loaded=false;window.url="";window.grid=CE("div");window.container=CE("div");window.desc=CE("span");window.prevb=CE("img");window.nextb=CE("img");window.img=CE("img");window.mdata={};window.empty;window.prog=CE("span");window.uploads={active:0,queued:0};window.upname="";window.imgs=[];window.lastmove=time();window.chidden=false;window.iwi=0;window.ix=0;window.ib=0;window.sidebar=CE("div");window.badbrowser=navigator.userAgent.toLowerCase().indexOf("webkit")!==-1;window.xhr=function(){return window.XMLHttpRequest?new XMLHttpRequest():new ActiveXObject("Microsoft.XMLHTTP")};var a=grid.style;a.webkitTransitionDuration=a.oTransitionDuration=a.msTransitionDuration=a.transitionDuration="0.7s";sidebar.classList.add("fade");sidebar.id="sidebar";prog.id="progress";container.id="bigpic";container.style.cursor="pointer";container.style.display="none";container.addEventListener("click",iclick);prevb.src=svg?"icons/prev.svg":"icons/prev.png";prevb.classList.add("prev");prevb.classList.add("symbol");prevb.classList.add("vertcent");prevb.classList.add("fade");prevb.style.width="10%";prevb.addEventListener("click",prev);nextb.src=svg?"icons/next.svg":"icons/next.png";nextb.classList.add("next");nextb.classList.add("symbol");nextb.classList.add("vertcent");nextb.classList.add("fade");nextb.style.width="10%";nextb.addEventListener("click",next);img.classList.add("largepic");img.classList.add("cent");img.classList.add("fade");img.classList.add("loadingbg");if(smalldev){img.classList.add("pmode")}img.addEventListener("dblclick",fs);img.addEventListener("touchstart",force_fs);window.infobut=CE("img");infobut.src=svg?"icons/info.svg":"icons/info.png";infobut.classList.add("symbol");infobut.style.width="7%";infobut.style.bottom="2%";infobut.addEventListener("click",infooverlay);infobut.classList.add("horcent");infobut.classList.add("fade");window.infolay=CE("div");infolay.classList.add("infolay");infolay.classList.add("horcent");infolay.classList.add("closed");container.classList.add("fade");container.appendChilds(prevb,nextb,img,infobut,infolay);document.body.appendChilds(prog,grid,container,sidebar);sidebar.style.display="none";var d=Object.keys(files).sort(),c=0;for(;c<d.length;c++){var g=files[d[c]];if(typeof g!="string"){g.forEach(function(h){addimg(h);imgs.push(h)})}else{addimg(g);imgs.push(g)}}ety();loop();window.addEventListener("keypress",kinput);window.addEventListener("mousemove",moov);window.addEventListener("click",moov);window.addEventListener("touchmove",moov);window.addEventListener("touchstart",moov);window.addEventListener("touchend",moov);sidebar.addEventListener("mouseover",showstatus);sidebar.addEventListener("touchstart",showstatus);sidebar.addEventListener("mouseout",hidestatus);sidebar.addEventListener("touchend",hidestatus);if(!badbrowser){img.addEventListener("load",rstx)}var f=false,e=false;window.intr=interact(img).draggable({inertia:true,onstart:smimg,onend:emimg,onmove:mimg,axis:"x"});if(features.uploading){var b=document.querySelector(".upload");document.querySelector(".fileUpload").style.display="";b.addEventListener("change",fqueue);document.body.addEventListener("dragover",function(h){h.preventDefault()});document.body.addEventListener("drop",fqueue)}};